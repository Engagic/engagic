{
  "item": {
    "unified": {
      "description": "Unified prompt for all agenda items - LLM determines output length based on content complexity",
      "variables": [
        "title",
        "text"
      ],
      "output_format": "json",
      "response_schema": {
        "type": "object",
        "properties": {
          "summary_markdown": {
            "type": "string",
            "description": "Summary in markdown format - length varies by complexity (2-10 sentences, use sections/bold/lists as needed)"
          },
          "citizen_impact_markdown": {
            "type": "string",
            "description": "1-3 sentences in markdown explaining how this affects residents (can use bold for emphasis)"
          },
          "topics": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "housing",
                "zoning",
                "transportation",
                "budget",
                "public_safety",
                "environment",
                "parks",
                "utilities",
                "economic_development",
                "education",
                "health",
                "planning",
                "permits",
                "contracts",
                "appointments",
                "other"
              ]
            },
            "description": "1-3 canonical topics from the allowed list"
          },
          "confidence": {
            "type": "string",
            "enum": [
              "high",
              "medium",
              "low"
            ],
            "description": "Confidence level based on document clarity"
          }
        },
        "required": [
          "summary_markdown",
          "citizen_impact_markdown",
          "topics",
          "confidence"
        ]
      },
      "system_instruction": "You are an expert at analyzing city council agenda items for residents. Think step-by-step, extract all concrete details, cross-reference documents, and explain impact in plain language. Match your output depth to the item's complexity.",
      "template": "Analyze this city council agenda item and extract key information for residents.\n\n# Item Title\n\"{title}\"\n\n# Your Task\n\nProvide a structured JSON response. **Match your output depth to the item's complexity** - simple items get brief summaries, complex legislation gets thorough analysis.\n\n**ANALYSIS PROCESS:**\n\nRead the attached documents completely and extract detailed information:\n\n1. **Identify document type and extract accordingly:**\n\n   IF this is a **legislative document** (ordinance, resolution, contract, budget):\n   - Dollar amounts and funding breakdowns\n   - Addresses, locations, geographic areas affected\n   - Specific dates, timelines, phases, effective dates\n   - Ordinance/resolution numbers, legal citations\n   - Who approved, vote counts, sponsor names\n   - For ordinances with multiple provisions: extract each numbered provision\n\n   IF this is a **data presentation** (briefing, report, slides, statistics):\n   - ALL percentages and trends (e.g., \"-21% reduction\", \"+15% increase\")\n   - Before/after comparisons with specific numbers and timeframes\n   - Frameworks and methodologies being presented (name them explicitly)\n   - Case studies with locations and measurable outcomes\n   - Key metrics from tables/charts with full context\n   - Pilot program results with locations and dates\n\n   IF this is a **staff memo or analysis**:\n   - Recommendations and alternatives considered\n   - Cost-benefit analysis with specific numbers\n   - Implementation timeline and phases\n   - Stakeholder input and community feedback summarized\n   - Risk factors and mitigation strategies\n\n   IF this is an **appeal, variance, or quasi-judicial hearing**:\n   - **Backstory**: What circumstances led to this request? What changed? (ownership change, death, new regulations, grandfathered situations, hardship)\n   - **Timeline**: How long has the situation, business, or use existed?\n   - **Stakeholders**: Who is affected and what is at stake for them?\n   - **Procedural history**: What did staff or lower bodies (Planning Commission, Zoning Board) decide? Why?\n   - **Deliberation dynamics**: Did elected officials disagree with staff or commission? If so, why?\n   - **Applicant statements**: Key points from justification letters, appeal filings, or public testimony\n   - **Outcome reasoning**: Why was the final decision made (or recommended)?\n\n   IF this is a **fiscal health or credit rating report**:\n   - Current ratings from each agency with outlook (positive/stable/negative)\n   - Quantified risk: probability of upgrade/downgrade, timeline\n   - Structural factors: revenue vs expenditure growth rates, fixed cost ratios\n   - Political contingencies: assumptions baked into \"balanced\" budgets (e.g., future tax measures)\n   - What investor behavior actually signals (collateral strength vs. operational confidence)\n   - Comparison to policy targets and peer medians\n\n   **ALWAYS extract** (regardless of type):\n   - Names of contractors, agencies, officials, sponsors\n   - Program mechanics and service delivery details\n   - Performance metrics, outcomes, success rates\n   - Examples and case studies from documents\n\n2. **Synthesize information** across documents:\n   - Explain how programs actually work\n   - Provide context and background from documents\n   - Include implementation details and requirements\n   - Cross-reference numbers and facts for accuracy\n\n3. **Build summary** matching complexity to content:\n   - Start with what this does (use specifics from documents)\n   - Add context about why (background, justification, need)\n   - Explain who benefits and how (populations served, concrete impacts)\n   - Include timelines and implementation phases where relevant\n   - Use real examples and metrics from attachments\n\n# Response Format\n\nReturn valid JSON with these fields:\n- **summary_markdown**: Summary (markdown, 2-10 sentences depending on complexity)\n- **citizen_impact_markdown**: How this affects residents (markdown, 1-3 sentences)\n- **topics**: Array of 1-3 canonical topics\n- **confidence**: \"high\", \"medium\", or \"low\"\n\n# Deciding Output Length\n\n**SIMPLE items** (2-3 sentences summary, 1 sentence impact):\n- Single appointments or confirmations\n- Routine contract renewals with no changes\n- Administrative housekeeping\n\n**MODERATE items** (4-5 sentences summary, 1-2 sentences impact):\n- Budget amendments or transfers\n- Standard permit approvals\n- Single-purpose resolutions\n- Contract awards with clear scope\n\n**COMPLEX items** (6-10 sentences summary with sections, 2-3 sentences impact):\n- Ordinances amending code (especially with multiple numbered provisions)\n- Development projects with multiple components\n- Policy changes affecting rights, regulations, or fees\n- Items with significant financial impact or controversy\n- Zoning changes, land use decisions\n- Anything with tenant protections, affordability requirements, or displacement implications\n- Fiscal health reports, credit ratings, or structural budget analyses\n\nFor COMPLEX items:\n- Use markdown sections (e.g., **Key Provisions:**, **Financial Details:**, **Timeline:**)\n- Use bullet lists for multiple components\n- Include ALL dollar amounts, dates, addresses\n- Explain both immediate and long-term implications\n\n# Guidelines\n\n## Summary (markdown)\n- Always include: dollar amounts, addresses, dates, ordinance numbers when present\n- Use **bold** for key numbers and names\n- Use bullet lists for multiple components\n- Plain language, no jargon\n- If unclear/contradictory, note this explicitly\n- For fiscal reports: quantify risk, don't soften bad news\n\n## Topics (1-3 from canonical list)\nhousing, zoning, transportation, budget, public_safety, environment, parks, utilities, economic_development, education, health, planning, permits, contracts, appointments, other\n\n**Always use canonical topics only.** Do not create new topic names.\n\n## Citizen Impact (markdown)\nHow does this affect residents' lives?\n- Direct costs (taxes, fees, fines)\n- Services (trash, water, roads, parks)\n- Rights and regulations (what you can/can't do)\n- Neighborhood changes (development, traffic, noise)\n- Housing stability, tenant protections, displacement risk\n- Future borrowing costs and fiscal constraints\n\nUse **bold** to emphasize the most significant impact.\n\n## Confidence\n- **high**: Documents are clear, detailed, and consistent\n- **medium**: Some ambiguity, missing context, or minor conflicts\n- **low**: Documents are unclear, contradictory, severely incomplete, or unreadable\n\n# Examples\n\n## Example 1: Simple Appointment\nTitle: \"Appointment of Jane Smith to Planning Commission\"\nDocuments: Resolution appointing Jane Smith, term 2025-2029, replacing John Doe.\n\nOutput:\n```json\n{{\n  \"summary_markdown\": \"Jane Smith appointed to Planning Commission for **4-year term (2025-2029)**, replacing John Doe whose term expired.\",\n  \"citizen_impact_markdown\": \"New commissioner will vote on **development projects and zoning changes** affecting your neighborhood.\",\n  \"topics\": [\"appointments\"],\n  \"confidence\": \"high\"\n}}\n```\n\n## Example 2: Complex Development\nTitle: \"Approval of Oak Street Mixed-Use Development\"\nDocuments: 45-page development agreement, site plans, traffic study, affordable housing plan.\n\nOutput:\n```json\n{{\n  \"summary_markdown\": \"Approves 240-unit mixed-use development at **1500 Oak Street** including:\\n\\n- 180 market-rate apartments\\n- 60 affordable units (80% AMI)\\n- 15,000 sq ft retail\\n- 320 parking spaces\\n\\nDeveloper (Acme Properties) pays **$2.4M in impact fees** and builds new traffic signal at Oak/Main intersection.\\n\\n**Timeline:** Groundbreaking Q1 2026, completion Q4 2027. Includes 15-year affordability covenant.\",\n  \"citizen_impact_markdown\": \"Adds **240 housing units (60 affordable)** to downtown and increases retail options, but may worsen traffic on Oak Street until new signal is installed.\",\n  \"topics\": [\"housing\", \"zoning\", \"transportation\"],\n  \"confidence\": \"high\"\n}}\n```\n\n## Example 3: Complex Legislative Ordinance\nTitle: \"Ordinance amending the Planning Code to 1) require property owners seeking to demolish residential units to replace all units; 2) prohibit demolition permits for five years if tenant vacated due to harassment...\"\nDocuments: Legislative text (Ver5), Planning Commission transmittal, staff presentation.\n\nOutput:\n```json\n{{\n  \"summary_markdown\": \"This ordinance significantly amends San Francisco's Planning and Administrative Codes to strengthen tenant protections related to residential demolitions and renovations. Introduced by Supervisor Chen and refined through several committee amendments.\\n\\n**Key Provisions:**\\n\\n- **Unit Replacement:** Property owners must replace all demolished residential units with \\\"Comparable Units\\\" (same bedrooms, full bathrooms, at least 90% of original square footage). Affordable units must remain affordable for the life of the project.\\n- **Tenant Protections:** Definition of \\\"Existing Occupant\\\" expanded to include tenants who vacated due to harassment (within 5 years), improper buyout agreements, owner move-ins (within 3 years), or Ellis Act evictions. All displaced households receive relocation assistance (e.g., **$10,863.45 per tenant**, up to **$32,590.33 per unit**).\\n- **Demolition Prohibitions:** Demolition permits prohibited for 5 years if tenant vacated due to harassment or improper buyout.\\n- **Enforcement:** Private right of action established with civil penalties up to **$10,000 per violation** (treble for willful violations).\",\n  \"citizen_impact_markdown\": \"Residents facing displacement due to demolition or major renovations will receive **enhanced relocation assistance** and clearer rights to return or secure comparable affordable housing. Provides stronger protections against tenant harassment and improper buyout agreements.\",\n  \"topics\": [\"housing\", \"planning\"],\n  \"confidence\": \"high\"\n}}\n```\n\n## Example 4: Budget Amendment\nTitle: \"FY2025 Budget Amendment - Parks Department\"\nDocuments: Budget transfer resolution, staff memo.\n\nOutput:\n```json\n{{\n  \"summary_markdown\": \"Transfers **$125,000** from Parks Department general fund to emergency repairs budget for Central Park playground equipment replacement. Original equipment failed safety inspection in August 2025. Work to be completed by **December 2025**.\",\n  \"citizen_impact_markdown\": \"Central Park playground **currently closed for safety** will reopen by year-end with new equipment; **no tax increase** required (uses existing budget).\",\n  \"topics\": [\"budget\", \"parks\"],\n  \"confidence\": \"high\"\n}}\n```\n\n## Example 5: Unclear Documents\nTitle: \"Downtown Streetscape Improvements\"\nDocuments: Partial memo, unreadable scanned images.\n\nOutput:\n```json\n{{\n  \"summary_markdown\": \"Proposes downtown streetscape improvements. **Documents incomplete or unreadable** - specific scope, costs, timeline, and contractor information unavailable.\",\n  \"citizen_impact_markdown\": \"**Impact unclear** due to incomplete documentation - may affect downtown accessibility and parking during construction.\",\n  \"topics\": [\"planning\"],\n  \"confidence\": \"low\"\n}}\n```\n\n## Example 6: Variance Appeal with Human Context\nTitle: \"Appeal of Variance V-25-22 - Daycare Distance Requirements\"\nDocuments: Appeal filing, staff report, Planning Commission order, applicant justification letter.\n\nOutput:\n```json\n{{\n  \"summary_markdown\": \"**Background:** A community daycare at **15 E 25th Street** operated for over **22 years** under previous owner Ms. Caldwell. Following her death in 2025, new owner Tonya Brock purchased the facility to continue serving families. Upon applying for renovation permits, the city discovered a registered sexual predator had since moved within the required 2,500-foot buffer zone, though the daycare predated the predator's arrival.\\n\\n**The Conflict:** Current zoning requires 2,500 feet between daycares and predator residences. The ownership change reset the facility's legal status, subjecting it to current standards despite 22 years of continuous operation. The predator was effectively grandfathered into their residence while the daycare faced closure.\\n\\n**Procedural History:** The Planning Commission denied the variance by strictly applying code requirements. The applicant appealed, noting that five similar variances by another operator had previously been approved. The Land Use and Zoning Committee, recognizing the circumstances and the facility's long service history, voted **6-0 to grant the appeal**.\\n\\n**Variance granted:** Distance reduced to 1,980 ft, parking from 8 to 1 space, loading zone requirement eliminated.\",\n  \"citizen_impact_markdown\": \"A **22-year community daycare** will continue operating rather than close due to circumstances beyond the owner's control. The decision illustrates how elected officials may apply equitable judgment when strict code enforcement would produce unjust outcomes.\",\n  \"topics\": [\"zoning\", \"planning\"],\n  \"confidence\": \"high\"\n}}\n```\n\n## Example 7: Fiscal Health Informational Report\nTitle: \"Informational Report on Credit Ratings for GO Bonds, Series 2025\"\nDocuments: Staff report, rating agency reports from Moody's and S&P, bond sale summary presentation.\n\nOutput:\n```json\n{{\n  \"summary_markdown\": \"**Informational report** on credit ratings following the city's $334M Series 2025 bond sale. All three rating agencies maintain **negative outlooks**, signaling ~1-in-3 chance of further downgrade within 12-24 months:\\n\\n- Moody's: Aa2 (Negative)\\n- S&P: AA- (Negative)\\n- Fitch: A (Negative)\\n\\n**Structural concerns cited by agencies:**\\n- Expenditures growing ~7%/year vs revenue ~5%/year\\n- Police overtime **79% over budget**; public safety comprises 59% of general fund\\n- $188M in federal stimulus masked deficits through FY2023\\n- Reserves declined from 43% to 39% of revenue\\n\\n**Bond sale results:** 2x oversubscribed, 3.99% interest rate, $4.7M refunding savings. However, GO bonds are secured by property taxesâ€”investor demand reflects the tax base, not confidence in fiscal management.\\n\\n**Political risk:** FY2027 'balanced' budget assumes **$40M from a June 2026 tax measure** that hasn't passed. Contingency cuts activate if it fails.\",\n  \"citizen_impact_markdown\": \"Credit ratings affect **borrowing costs for schools, roads, and housing projects**. The negative outlook means the city faces hard choices: public safety spending drives the deficit but is politically difficult to cut. Further downgrades would increase costs for future bonds, ultimately borne by taxpayers.\",\n  \"topics\": [\"budget\"],\n  \"confidence\": \"high\"\n}}\n```\n\n# Edge Cases\n\n- **Empty/unreadable documents**: confidence=\"low\", note in summary\n- **Title conflicts with content**: Trust content over title, note discrepancy in summary\n- **Multiple contradictory sources**: Explain conflict in summary, confidence=\"medium\"\n- **Purely procedural items**: Still explain what's happening, impact can be \"Administrative matter with **no direct public impact**.\"\n- **Informational reports with no action**: Still assess implications and risks; don't sanitize bad news\n\n# Attached Documents\n\n{text}\n\n# Remember\n\n- **Match depth to complexity** - don't under-explain important legislation\n- Concrete over vague: **\"$2.4M\"** not \"several million\"\n- Specific over general: **\"1500 Oak Street\"** not \"downtown\"\n- Dates over timeframes: **\"December 2025\"** not \"soon\"\n- For ordinances with multiple provisions, extract and explain each one\n- For fiscal reports, quantify risk and name structural traps\n- Always use canonical topics from the list\n- Citizen impact required for all items\n- Use markdown **bold** to emphasize key facts\n- Return valid JSON"
    }
  },
  "meeting": {
    "short_agenda": {
      "description": "FALLBACK: For full meeting packets <=30 pages when item-level processing unavailable. Used when: (1) Vendor doesn't support item extraction, (2) HTML agenda parsing fails, (3) Manual override. Returns plain markdown text (no JSON, no topics). Most cities use item-level processing instead.",
      "variables": [
        "text"
      ],
      "template": "This is a city council meeting agenda. Provide a clear, concise summary that covers:\n\n**Key Agenda Items:**\n- List the main topics/issues being discussed\n- Include any public hearings or votes\n- Note any budget or financial items\n\n**Important Details:**\n- Specific addresses, dollar amounts, ordinance numbers\n- Deadlines or implementation dates\n- Public participation opportunities\n\nKeep it brief but informative. Focus on what citizens need to know.\n\nFormat your response in clean, readable markdown using:\n- ## for section headings\n- Bold for emphasis\n- Bullet lists for items\n- Clear paragraph breaks for readability\n\nAgenda text:\n{text}"
    },
    "comprehensive": {
      "description": "FALLBACK: For large/complex agendas >30 pages when item-level processing unavailable. Same use cases as short_agenda but for complex meetings. Returns plain markdown text (no JSON, no topics). Item-level processing is strongly preferred when available.",
      "variables": [
        "text"
      ],
      "template": "Analyze this city council meeting agenda and provide a comprehensive summary for residents.\n\n**Complete Agenda Items** (list every single one):\n- Item number and full title\n- Complete description of what's being proposed\n- Department or presenter\n- Action required (vote, discussion, information only)\n\n**Financial Details** (every dollar amount):\n- Budget items with exact amounts\n- Contract values and vendors\n- Grant amounts and sources\n- Fee changes or rate adjustments\n\n**Property and Development** (all locations):\n- Complete addresses for any property discussed\n- Zoning changes with current and proposed zoning\n- Development project names and descriptions\n- Square footage, units, or measurements\n\n**Public Participation**:\n- Public hearing items with times\n- Comment period details\n- How to participate (in person, online, written)\n- Deadlines for input\n\n**Key Details to Preserve**:\n- Exact dollar amounts (not \"several million\" but \"$3,456,789\")\n- Complete addresses (not \"downtown\" but \"123 Main Street\")\n- Full names and titles\n- Precise dates and times\n- Ordinance and resolution numbers\n\nBe thorough and detailed. Skip pure administrative items unless they have significant public impact.\n\nFormat your response in clean, readable markdown using:\n- ## for section headings\n- ### for subsections if needed\n- Bold for emphasis\n- Bullet lists for items\n- Clear paragraph breaks for readability\n\nAgenda text:\n{text}"
    }
  }
}